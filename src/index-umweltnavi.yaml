$schema: https://json-schema.org/draft/2020-12/schema
$id: https://example.com/schemas/1.0.0/umweltnavi.yaml
title: Schema for InGrid Index "Umweltnavi"
type: object
allOf:
  - $ref: ./parts/core.yaml
  - $ref: ./parts/shared-types.yaml#/$defs/metadata
  - $ref: ./parts/shared-types.yaml#/$defs/website
  - type: object
    title: UmweltNavi
    properties:
      umweltnavi:
        type: object
        description: All field for umweltnavi
        properties:
          oid:
            type: string
            description: 'Objekt ID (eindeutig über alle Datenkataloge). Setzt sich aus 
              "source" und "identifier" (bzw. "source" und "origin" und
              "classification") zusammen und wird für Eigenschaft "id" verwendet.'
            examples:
            - nlwkn-dsk-4922-21000
          part:
            type: number
            description: | 
              Wegen zu großer Geometrien, können für Objekte verschiedene Sub Geometrien existieren. 
              BIPU Index Modell
              In UMWELTNAVI immer 0; in UMWELTNAVI_SUB_GEOMETRY immer > 0
              Wenn > 0 dann wird nur das Feld "geometrie" verwendet.
            enum:
            - In UMWELTNAVI immer 0; in UMWELTNAVI_SUB_GEOMETRY immer > 0
            $comment: 'Ehemaliges Indexfeld: doc_index'
          type:
            type: string
            description: 'Statuslayer: "map"'
            enum:
            - object
            - map
          category:
            type: object
            properties:
              name:
                type: string
                examples:
                - Lärmindex Nacht
              slug:
                type: string
                examples:
                - laermindex-nacht
            required:
            - name
            - slug
            description: Kategorie im BIPU Datenmodell
          lod_weight:
            type: number
            description: Level of Detail für das Einblenden von Objekten, wenn weiter raus
            $comment: 'Ehemaliges Indexfeld: lod_sort_weight'
          geometry_type:
            type: string
            description: Wird pro Datenquelle gesetzt, gilt für alle Daten einer Datenquelle.
              Wird für Outlineberechnung benötigt (PostGIS SQL Queries). z.B. Fluss als Linie,
              LSG als Fläche
            enum:
            - polygon
            - line
            - point
          source:
            type: string
            description: Beschreibt Datenkatalog (Herkunft)
            examples:
            - NLWKN_DSK
          identifier:
            type: string
            description: 'ID des Objektes innerhalb des Datenkataloges, Teil der OID, Nicht für "Status-Layer"'
            $comment: 'Ehemaliges Indexfeld: code'
          origin:
            type: string
            description: 'Nur für "Status-Layer", zusammen mit Kategorie "Lärmindex Nacht" ergibt sich folgende Id: laermindex-nacht-strasse-city-50'
            examples:
              - Straße (City)
          classification:
            type: string
            description: 'Nur für "Status-Layer", zusammen mit Kategorie "Lärmindex Nacht" ergibt sich folgende Id: laermindex-nacht-strasse-city-50'
            examples:
              - '50'
            $comment: 'Ehemaliges Indexfeld: weight'
          service:
            type: array
            description: Verpflichtend für Datensätze mit WMS Diensten
            items:
              type: object
              properties:
                url:
                  type: string
                  $comment: 'Ehemaliges Indexfeld: wms.url'
                type:
                  type: string
                  enum:
                  - wms
                  - wmts
                  $comment: 'Ehemaliges Indexfeld: wms.type'
                layer:
                  type: array
                  items:
                    type: object
                    properties:
                      legend:
                        type: string
                        $comment: 'Ehemaliges Indexfeld: wms.legend.url'
                      name:
                        type: string
                        description: WMS Layername
                      title:
                        type: string
                        description: Display Title
                    required:
                    - name
                    $comment: 'Ehemaliges Indexfeld: wms.layer'
                  minItems: 1
              required:
              - url
              - type
              - layer
            minItems: 1
          info_text:
            type: string
            $comment: 'Ehemaliges Indexfeld: info'
          icon:
            type: string
          images:
            type: array
            items:
              $ref: "./parts/shared-types.yaml#/$defs/UmweltNaviImage"
              description: Liste der Bilder zum Objekt (extrahiert aus content_items)
            minItems: 0
          license:
            type: object
            properties:
              name:
                type: string
              url:
                type: string
            required:
            - name
          owner:
            type: object
            properties:
              name:
                type: string
              url:
                type: string
            required:
            - name
          provider:
            type: object
            properties:
              name:
                type: string
            required:
            - name
            description: Normalisierter Anbieter zur Bildung von Facetten
          contact:
            type: string
            description: Adresse des Objekts
            examples:
            - 'Hanauer Landstr. 52, 60314 Frankfurt' 
            - 'Ansprechpartner: Frank Kruse'
            $comment: 'Ehemaliges Indexfeld: address'
          metadata_url:
            type: string
            description: Referenz zu externem Metadatensatz
            $comment: 'Ehemaliges Indexfeld: meta_data_url'
          content_items:
            type: object
            properties:
              name:
                type: string
                description: Name des Inhaltsbereichs
                examples:
                - 'Bilder, Beschreibung, Wikipedia, Steckbrief'
              items:
                allOf:
                  - type: object
                    required:
                      - type
                    description: Liste der Inhalte
                    properties:
                      type:
                        type: string
                        enum:
                          - image
                          - text
                          - link
                      url:
                        type: string
                        description: Für Link und Bild
                      title:
                        type: string
                        description: Titel des Elementes
                      content:
                        type: string
                        description: Angaben zur Herkunft des Inhalts
                        $comment: 'Ehemaliges Indexfeld: object_date'
                      assigned_to:
                        type: string
                        description: Partner für den das Detail spezifisch erstellt wurde. Leer
                          bedeutet für alle Partner.
                        enum:
                        - ni
                        - sh
                        - rp
                  - $ref: "./parts/shared-types.yaml#/$defs/UmweltNaviSourceAttributes"
            required:
            - name
            - items
            description: Liste der Inhalte zum Objekt unterteilt in Bereiche
            $comment: 'Ehemaliges Indexfeld: data'
          relations:
            type: object
            properties:
              name:
                type: string
                description: Name der Relation
                examples:
                - enthält, gehört zu
              items:
                type: object
                properties:
                  oid:
                    type: string
                  name:
                    type: string
                required:
                - oid
                - name
            required:
            - name
            - items
          import_date:
            $ref: "./parts/shared-types.yaml#/$defs/TypedPeriodOfTime"
            description: Datum des Imports in die Datenbank
          import_ref:
            type: string
            description: 'Enthält Datenbank ID des Objekts (Attribut "original") und ggf. des überschreibenden Objekts (Attribut: "override")'
            examples:
            - '{ "original": 27900, "override": 1 }'
          importer_id:
            type: string
            description: Welcher Import (DAG, Importer Instanz, iPlug)
            examples:
            - data_catalog_import_db
          target_platform:
            type: string
            description: Target des Datesatzes (App oder Portal)
            enum:
            - web
            - app
          assigned_to:
            type: string
            description: Partner für den der Datensatz spezifisch erstellt wurde. Leer bedeutet für alle Partner.
            enum:
            - ni
            - sh
            - rp
          tags:
            type: array
            items:
              type: string
              examples:
              - 'spatial-object, map-service '
            minItems: 0
          indexed_terms:
            type: array
            items:
              type: string
              description: Für Volltextsuche, enthält Kategorienamen und Namen von Sammlungen, Statistiken etc für separate Gewichtung von fulltext
            minItems: 0
          statistics:
            type: array
            items:
              type: object
              properties:
                oid:
                  type: string
                  description: Eindeutige ID der Statistik
                  examples:
                  - 'bevoelkerungsentwicklung-bis-2021-bkg-vg250-gemeinden-10046118 '
                name:
                  type: string
                  description: Name der Statistik
                  examples:
                  - 'Bevölkerungsentwicklung bis 2021 '
                category:
                  type: object
                  properties:
                    name:
                      type: string
                      examples:
                      - Bevölkerungsentwicklung
                    slug:
                      type: string
                      examples:
                      - bevoelkerungsentwicklung
                  required:
                  - name
                  - slug
                  description: Kategorie im BIPU Datenmodell, wird für die Suche verwendet, damit nach Statistik-Kategorie gesucht werden kann.
                source:
                  type: string
                  description: Beschreibt Statistik (Herkunft)
                info_text:
                  type: string
                property:
                  type: string
                  examples:
                  - Bodenversiegelung [%]
                unit:
                  type: string
                  examples:
                  - '%'
                values:
                  type: object
                  properties:
                    display_date:
                      type: string
                      description: Zeitwert für die Anzeige im Diagramm
                      $comment: 'Ehemaliges Indexfeld: time'
                    value:
                      type: string
                      description: Wert pro Zeitwert
                  required:
                  - display_date
                  - value
                license:
                  type: object
                  properties:
                    name:
                      type: string
                    url:
                      type: string
                  required:
                  - name
                owner:
                  type: object
                  properties:
                    name:
                      type: string
                    url:
                      type: string
                  required:
                  - name
                temporal:
                  $ref: "./parts/shared-types.yaml#/$defs/TypedPeriodOfTime"
                  description: Datum der Erhebung der Statistik
                  $comment: 'Ehemaliges Indexfeld: object_date'
                import_date:
                  type: string
                  description: Datum des Imports in die Datenbank
                import_ref:
                  type: number
                  description: entkält Datenbank ID der Statistik
                importer_id:
                  type: string
                  description: Welcher Import (DAG, Importer Instanz, iPlug)
                  examples:
                  - csv
              required:
              - oid
              - name
              - category
              - property
              - unit
              - values
              - import_date
              - import_ref
              - importer_id
              description: Statistiken, die einem Objekt zugeordnet sind.
              $comment: 'Ehemaliges Indexfeld: properties.statistics'
            minItems: 0
          collections:
            type: array
            items:
              type: object
              properties:
                oid:
                  type: string
                  description: Eindeutige ID der Sammlung
                  examples:
                  - Arten-bfn-ffh-de4622302
                name:
                  type: string
                  description: Name der Sammlung
                  examples:
                  - Arten
                category:
                  type: object
                  properties:
                    name:
                      type: string
                      examples:
                      - 'Bevölkerungsentwicklung '
                    slug:
                      type: string
                      examples:
                      - 'bevoelkerungsentwicklung '
                  required:
                  - name
                  - slug
                  description: Kategorie im BIPU Datenmodell, wird für die Suche verwendet,
                    damit nach Sammlungs-Kategorie gesucht werden kann.
                source:
                  type: string
                  description: Beschreibt Sammlung (Herkunft)
                info_text:
                  type: string
                url:
                  type: string
                  description: URL zu einer Sammlung, z.B. zu den Arten eines Naturschutzgebietes in observation.org
                groups:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        description: Name der Artengruppe
                      url:
                        type: string
                        description: URL, z.B. für Artengruppenanzeige eines Naturschutzgebietes auf observation.org
                      items:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            url:
                              type: string
                            temporal:
                              $ref: "./parts/shared-types.yaml#/$defs/TypedPeriodOfTime"
                              description: Fund, Beobachtung in Observation.org
                              $comment: 'Ehemaliges Indexfeld: object_date'
                            image:
                              $ref: "./parts/shared-types.yaml#/$defs/UmweltNaviImage"
                          required:
                          - name
                        minItems: 0
                    required:
                    - name
                    description: z.B. eine Artengruppen
                  minItems: 0
                license:
                  type: object
                  properties:
                    name:
                      type: string
                    url:
                      type: string
                  required:
                  - name
                owner:
                  type: object
                  properties:
                    name:
                      type: string
                    url:
                      type: string
                  required:
                  - name
                temporal:
                  type: string
                  description: Datum der Erhebung der Statistik
                  $comment: 'Ehemaliges Indexfeld: object_date'
                import_date:
                  type: string
                  description: Datum des Imports in die Datenbank
                import_ref:
                  type: number
                  description: entkält Datenbank ID der collection
                importer_id:
                  type: string
                  description: Welcher Import (DAG, Importer Instanz, iPlug)
                  examples:
                  - observation_org
              required:
              - oid
              - name
              - category
              - import_date
              - import_ref
              - importer_id
              description: z.B. Arten eines Naturschutzgebietes
              $comment: 'Ehemaliges Indexfeld: properties.collections'
            minItems: 0
        allOf:
          - if:
              properties:
                type:
                  const: object
              required:
                - type
            then:
              required:
                - identifier
          - if:
              properties:
                type:
                  const: map
              required:
                - type
            then:
              required:
                - origin
                - classification
        required:
        - oid
        - part
        - type
        - category
        - source
        - provider
        - import_date
        - import_ref
        - importer_id
